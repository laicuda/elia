# Parents get one or several e-mails containing ebook licenses and installation instructions from publishers

As ususally, licenses are ordered from several publishers and not all licenses are available at the same time, this step allows for sending several e-mails each time, new licenses are available.

## Preparation: List of licenses

The license keys are managed in a JSON file. An empty JSON file is generated by running [`../src/04_init_license_file.py`](../src/04_init_license_file.py). Based on the list of available ebooks (`AVAILABLE_EBOOK_LIST_CSV` in [`../src/ebook_config.py`](../src/ebook_config.py)) a JSON file with an entry for every book is generated (`EBOOK_LICENSES_JSON` in [`../src/ebook_config.py`](../src/ebook_config.py)).

The generated file for my *example data* looks as follows:
```
{
    "D": {
        "Buchbezeichnung": "Deutschbuch",
        "Verlag": "Athene",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    },
    "E": {
        "Buchbezeichnung": "Englischbuch",
        "Verlag": "Zeus",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    },
    "M": {
        "Buchbezeichnung": "Mathebuch",
        "Verlag": "Hera",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    },
    "La-1": {
        "Buchbezeichnung": "Lateinbuch",
        "Verlag": "Zeus",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    },
    "La-2": {
        "Buchbezeichnung": "Latein-Grammatik",
        "Verlag": "Zeus",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    }
}
```

It contains some redundant information, but that makes it easier for me in the following steps. Once you received license keys, you should provide them as a list of strings in the field "Lizenzschluessel", e.g. after receiving two license keys from publisher "Athene", I enter them as follows:

```
{
    "D": {
        "Buchbezeichnung": "Deutschbuch",
        "Verlag": "Athene",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": [
            "ABCDEF",
            "GHIJKL"
        ]
    },
    "E": {
        "Buchbezeichnung": "Englischbuch",
        "Verlag": "Zeus",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    },
    "M": {
        "Buchbezeichnung": "Mathebuch",
        "Verlag": "Hera",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    },
    "La-1": {
        "Buchbezeichnung": "Lateinbuch",
        "Verlag": "Zeus",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    },
    "La-2": {
        "Buchbezeichnung": "Latein-Grammatik",
        "Verlag": "Zeus",
        "vergebeneLizenzen": 0,
        "Lizenzschluessel": []
    }
}
```

## Preparation: Installation instructions

Together with the ebook licenses, installation instructions and terms of usage can be sent, both as text and as file attachment. For each publisher, you can provide an entry in a JSON file. Its name is specified in `INSTALLATION_INSTRUCTIONS` in [`../src/ebook_config.py`](../src/ebook_config.py).

*Example:* [`../data/installation-details.json`](../data/installation-details.json)

```
{
    "Athene": {
        "Installation": [
            "E-Book Lizenzen von Athene können wie folgt genutzt werden:",
            "1. Tu dies.",
            "2. Mach jenes."
        ],
        "Dateien": [
            "../data/athene_1.pdf",
            "../data/athene_2.pdf"
        ]
    },
    "Hera": {
        "Installation": [
            "Für Hera Lizenzen gibt es auch eine Anleitung.",
            "Allerdings sind dies nur Beispieldaten, so dass hier nichts sinnvolles steht."
        ],
        "Dateien": []
    },
    "Zeus": {
        "Installation": [
            "Zeus sagt:",
            "1. Zuerst dies.",
            "2. Dann das...",
            "   ... und das.",
            "3. Schließlich dieses."
        ],
        "Dateien": [
            "../data/zeus.pdf"
        ]
    }
}
```

## Sending licenses

Actually sending the e-mails with license keys is done by the script [`../src/05_send_licenses.py`](../src/05_send_licenses.py). It uses 
- order data enriched with payment information (`ORDER_DATA_JSON` in [`../src/ebook_config.py`](../src/ebook_config.py))
- license keys as provided in `EBOOK_LICENSES_JSON` in [`../src/ebook_config.py`](../src/ebook_config.py), and
- installation instructions as provided in `INSTALLATION_INSTRUCTIONS` in [`../src/ebook_config.py`](../src/ebook_config.py)
as well as 
- e-mail settings (login, server, port, ...) as provided in [`../src/ebook_config.py`](../src/ebook_config.py).

An e-mail with license keys is sent, if
- licenses have been paid, and
- (enough) licenses are available.

The text of the e-mail is currently generated inside the script. Later on, this should be part of the config file.

An updated version of the order data is saved (sent license keys are added). Moreover, an updated version of the license key file is saved (number of used license keys is updated).

The script [`../src/05_send_licenses.py`](../src/05_send_licenses.py) provides a `dry_run` mode, that shows e-mail on the screen rather than sending them.